#!/usr/local/bin/python 


ADDALIASES_CMD = '/home/mailman/mailman/bin/addaliases'

import sys, crypt, os, string

sys.path.append('/home/mailman/mailman/modules')

import maillist, mm_utils

list_name = string.lower(raw_input("Enter the name of the list: "))

if list_name in maillist.list_names():
    sys.stderr.write("** List with name %s already exists\n" % `list_name`)
    raise SystemExit, 1

owner_mail = raw_input("Enter the email of the person runing the list: ")
list_pw = raw_input("Enter the initial list password:")

newlist = maillist.MailList()
pw = crypt.crypt(list_pw , mm_utils.GetRandomSeed())
newlist.Create(list_name, owner_mail, pw)
os.system('%s %s' % (ADDALIASES_CMD, list_name))
newlist.SendTextToUser(subject="Your new mailing list", recipient=owner_mail,
	sender='mailman-owner@%s' % newlist.host_name, 
	text='''
The mailing list '%s' has just been created for you.  Here is some basic
information on your mailing list:

Your mailing list password is:
	 %s

You need this password to configure your mailing list.  You also need it to
handle administrative requests, such as approving mail if you choose to run
a moderated list.

You can configure your mailing list at the following web page:
	%s

The web page for users of your mailing list is: 
	%s

You can even customize these web pages from the list configuration page.  
However, you do need to know html to be able to do this.

To unsubscribe a user, from the mailing list web page, click on their
email address as if you were that user.  Where that user would put in
his password to unsubscribe, put in your admin password.  You can also
use your password to change peoples options to digestified /
non-digestified.

Soon There should be a Mailman web page that will have a reference on
running a Mailman mailing list.  Until then, please address all
questions to mailman-owner@%s. ''' % (list_name, list_pw, 
	newlist.GetScriptURL('admin'), newlist.GetScriptURL('listinfo'),
	newlist.host_name))

