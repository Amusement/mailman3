===============
MTA connections
===============

Outgoing connections to the outgoing mail transport agent (MTA) are mitigated
through a Connection class, which can transparently manage multiple sessions
to a single physical MTA.

    >>> from mailman.mta.connection import Connection

The number of connections per session is specified when the Connection object
is created, as is the host and port number of the SMTP server.

    >>> connection = Connection(
    ...     config.mta.smtp_host, int(config.mta.smtp_port), 1)

At the start, there have been no connections to the server.

    >>> smtpd.get_session_count()
    0

By sending a message to the server, a session is started.

    >>> connection.sendmail('anne@example.com', ['bart@example.com'], """\
    ... From: anne@example.com
    ... To: bart@example.com
    ... Subject: aardvarks
    ...
    ... """)
    {}

    >>> smtpd.get_session_count()
    1

We can reset the session count back to zero.

    >>> from smtplib import SMTP
    >>> def reset():
    ...     smtpd = SMTP()
    ...     smtpd.connect(config.mta.smtp_host, int(config.mta.smtp_port))
    ...     smtpd.docmd('RSET')

    >>> reset()
    >>> smtpd.get_session_count()
    0
