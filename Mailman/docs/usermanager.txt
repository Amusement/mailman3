The user manager
================

The IUserManager is how you create, delete, and manage users.  The Mailman
system instantiates an IUserManager for you based on the configuration
variable MANAGERS_INIT_FUNCTION.  The instance is accessible on the global
config object.

    >>> from Mailman.configuration import config
    >>> from Mailman.database import flush
    >>> from Mailman.interfaces import IUserManager
    >>> mgr = config.user_manager
    >>> IUserManager.providedBy(mgr)
    True


Creating users
--------------

There are several ways you can create a user object.  The simplest is to
create a 'blank' user by not providing an address or real name at creation
time.  This user will have an empty string as their real name, but will not
have a password.

    >>> from Mailman.interfaces import IUser
    >>> user = mgr.create_user()
    >>> flush()
    >>> IUser.providedBy(user)
    True
    >>> sorted(address.address for address in user.addresses)
    []
    >>> user.real_name
    ''
    >>> print user.password
    None

The user has preferences, but none of them will be specified.

    >>> print user.preferences
    <Preferences ...>

A user can be assigned a real name.

    >>> user.real_name = 'Anne Person'
    >>> flush()
    >>> sorted(user.real_name for user in mgr.users)
    ['Anne Person']

A user can be assigned a password.

    >>> user.password = 'secret'
    >>> flush()
    >>> sorted(user.password for user in mgr.users)
    ['secret']

You can also create a user with an address to start out with.

    >>> user_2 = mgr.create_user('bperson@example.com')
    >>> flush()
    >>> IUser.providedBy(user_2)
    True
    >>> sorted(address.address for address in user_2.addresses)
    ['bperson@example.com']
    >>> sorted(user.real_name for user in mgr.users)
    ['', 'Anne Person']

As above, you can assign a real name to such users.

    >>> user_2.real_name = 'Ben Person'
    >>> flush()
    >>> sorted(user.real_name for user in mgr.users)
    ['Anne Person', 'Ben Person']

You can also create a user with just a real name.

    >>> user_3 = mgr.create_user(real_name='Claire Person')
    >>> flush()
    >>> IUser.providedBy(user_3)
    True
    >>> sorted(address.address for address in user.addresses)
    []
    >>> sorted(user.real_name for user in mgr.users)
    ['Anne Person', 'Ben Person', 'Claire Person']

Finally, you can create a user with both an address and a real name.

    >>> user_4 = mgr.create_user('dperson@example.com', 'Dan Person')
    >>> flush()
    >>> IUser.providedBy(user_3)
    True
    >>> sorted(address.address for address in user_4.addresses)
    ['dperson@example.com']
    >>> sorted(address.real_name for address in user_4.addresses)
    ['Dan Person']
    >>> sorted(user.real_name for user in mgr.users)
    ['Anne Person', 'Ben Person', 'Claire Person', 'Dan Person']


Deleting users
--------------

You delete users by going through the user manager.  The deleted user is no
longer available through the user manager iterator.

    >>> mgr.delete_user(user)
    >>> flush()
    >>> sorted(user.real_name for user in mgr.users)
    ['Ben Person', 'Claire Person', 'Dan Person']


Finding users
-------------

You can ask the user manager to find the IUser that controls a particular
email address.  You'll get back the original user object if it's found.  Note
that the .get_user() method takes a string email address, not an IAddress
object.

    >>> address = list(user_4.addresses)[0]
    >>> found_user = mgr.get_user(address.address)
    >>> found_user
    <User "Dan Person" at ...>
    >>> found_user is user_4
    True

If the address is not in the user database or does not have a user associated
with it, you will get None back.

    >>> print mgr.get_user('zperson@example.com')
    None
    >>> user_4.unlink(address)
    >>> flush()
    >>> print mgr.get_user(address.address)
    None


Clean up
--------

    >>> for user in mgr.users:
    ...     mgr.delete_user(user)
    >>> flush()
    >>> list(mgr.users)
    []
